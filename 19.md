NIP-19
======

bech32 编码的实体
-----------------

`草案` `可选` `作者:jb55` `作者:fiatjaf` `作者:Semisol`

此 NIP 将 bech32 格式的字符串标准化，这些字符串可用于在客户端显示密钥、id 和其他信息。这些格式并不意味着在核心协议中的任何地方使用，它们仅用于向用户显示、复制粘贴、分享、渲染二维码和输入数据。

建议将 id 和密钥存储在十六进制或二进制格式中，因为这些格式更接近于核心协议实际使用的格式。

## 裸密钥与 id

为了防止私钥、公钥和事件 id 之间的混淆和混合，这些都是 32 字节的字符串。bech32-(not-m) 编码结合不同的前缀可分别被用于表示这些实体。

这些是可能的 bech32 前缀：

  - `npub`：公钥
  - `nsec`：私钥
  - `note`：贴文 id

示例：十六进制公钥 `3bf0c63fcb93463407af97a5e5ee64fa883d107ef9e558472c4eb9aaaefa459d` 转换为 `npub180cvv07tjdrrgpa0j7j7tmnyl2yr6yr7l8j4s3evf6u64th6gkwsyjh6w6`。

密钥和 id 的 bech32 编码不应在标准的 NIP-01 事件格式或过滤器内部使用，它们仅用于更友好的显示和输入。当下客户端仍应该接受十六进制和 npub 格式的公钥，并在内部进行转换。

## 带有额外元数据的可共享标识符

当分享个人资料或事件时，应用程序可以决定包含中继信息和其他元数据，以便其他应用程序可以更容易地定位和显示这些实体。

对于这些事件，内容是一个二进制编码的 `TLV`（类型-长度-值）列表，其中 `T` 和 `L` 各为 1 字节（`uint8`，即 0-255 范围内的数字），`V` 是由 `L` 指定大小的字节序列。

这些是可能的带有 `TLV` 的 bech32 前缀：

  - `nprofile`：一个 nostr 个人资料
  - `nevent`：一个 nostr 事件
  - `nrelay`：一个 nostr 中继
  - `naddr`：一个 nostr _可替换事件_ 坐标

这些可能的标准化 `TLV` 类型在这里指出：

- `0`：`special`
  - 取决于 bech32 前缀：
    - 对于 `nprofile`，它将是个人资料公钥的 32 字节
    - 对于 `nevent`，它将是事件 id 的 32 字节
    - 对于 `nrelay`，这是中继 URL
    - 对于 `naddr`，它是被引用事件的标识符（`"d"` 标签）。对于非参数化的可替换事件，使用空字符串。
- `1`：`relay`
  - 对于 `nprofile`，`nevent` 和 `naddr`，_可选地_，一个实体（个人资料或事件）更可能被找到的中继，编码为 ascii
  - 这可能被多次包含
- `2`：`author`
  - 对于 `naddr`，事件的公钥的 32 字节
  - 对于 `nevent`，_可选地_，事件的公钥的 32 字节
- `3`：`kind`
  - 对于 `naddr`，类型的 32 位无符号整数，大端表示
  - 对于 `nevent`，_可选地_，种类的 32 位无符号整数，大端表示

## 示例

- `npub10elfcs4fr0l0r8af98jlmgdh9c8tcxjvz9qkw038js35mp4dma8qzvjptg` 应解码为公钥十六进制 `7e7e9c42a91bfef19fa929e5fda1b72e0ebc1a4c1141673e2794234d86addf4e`，反之亦然
- `nsec1vl029mgpspedva04g90vltkh6fvh240zqtv9k0t9af8935ke9laqsnlfe5` 应解码为私钥十六进制 `67dea2ed018072d675f5415ecfaed7d2597555e202d85b3d65ea4e58d2d92ffa`，反之亦然
- `nprofile1qqsrhuxx8l9ex335q7he0f09aej04zpazpl0ne2cgukyawd24mayt8gpp4mhxue69uhhytnc9e3k7mgpz4mhxue69uhkg6nzv9ejuumpv34kytnrdaksjlyr9p` 应解码为具有以下 TLV 项的个人资料：
  - 公钥：`3bf0c63fcb93463407af97a5e5ee64fa883d107ef9e558472c4eb9aaaefa459d`
  - 中继：`wss://r.x.com`
  - 中继：`wss://djbas.sadkb.com`

## 注意

- `npub` 键在 NIP-01 事件或 NIP-05 JSON 响应中不能使用，只支持十六进制格式。
- 当解码一个 bech32 格式的字符串时，应忽略不被识别或支持的 TLV，而不是产生错误。
