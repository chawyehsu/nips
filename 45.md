NIP-45
======

事件计数
--------

`草案` `可选` `作者:staab`

中继可能支持 `COUNT` 动词，它提供了获取事件计数的机制。

## 动机

客户端可能想要对连接的中继执行一些查询，但这些查询可能代价过高，例如，为了获取给定公钥的关注者数量，客户端必须为了计数查询所有指向给定公钥的 kind-3 事件。结果可以被缓存，可以由客户端或者单独的索引服务器作为替代方案，但是这两个选项都会侵蚀网络的去中心化，因为它们在 Nostr 之上创建了二层协议。

## 过滤器和返回值

此 NIP 定义了 `COUNT` 动词，它接受一个订阅 id 和过滤器，如 [NIP 01](01.md) 中对 `REQ` 动词的规定。多个过滤器被以“或”的方式连在一起，并聚合成一个单一的计数结果。


```
["COUNT", <subscription_id>, <filters JSON>...]
```

计数使用一个 `COUNT` 响应并以 `{"count": <integer>}` 的形式返回。中继可以使用概率计数来减少计算需求。
如果中继使用概率计数，它**可以**在响应中用 `approximate` 键表示，即 `{"count": <integer>, "approximate": <true|false>}`。

```
["COUNT", <subscription_id>, {"count": <integer>}]
```

示例：

```
# 关注者计数
["COUNT", <subscription_id>, {"kinds": [3], "#p": [<pubkey>]}]
["COUNT", <subscription_id>, {"count": 238}]

# 贴文和反应计数
["COUNT", <subscription_id>, {"kinds": [1, 7], "authors": [<pubkey>]}]
["COUNT", <subscription_id>, {"count": 5}]

# 贴文大致计数
["COUNT", <subscription_id>, {"kinds": [1]}]
["COUNT", <subscription_id>, {"count": 93412452, "approximate": true}]
```
