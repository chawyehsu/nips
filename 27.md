NIP-27
======

文本贴文引用
------------

`草案` `可选` `作者:arthurfranca` `作者:hodlbod` `作者:fiatjaf`

本文档规范了客户端对事件和个人资料的内联引用在其 `.content` 中的处理方式，这些事件的 `.content` 中包含可读文本（例如类型 1 和 30023）。

当创建一个事件时，客户端应在 `.content` 中使用 [NIP-21](21.md) 代码，如 `nostr:nprofile1qqsw3dy8cpu...6x2argwghx6egsqstvg`，包含对其他个人资料和其他事件的提及。

对于每个引用，是否包含 [NIP-10](10.md) 风格的标签（`["e", <hex-id>, <relay-url>, <marker>]`）是可选的，在被提及的个人资料希望被通知到，或者被引用的事件希望将提及识别为回复时，客户端应这样做。

接收到 `.content` 中包含这样的 `nostr:...` 提及事件的阅读器客户端可以在处理过程中进行任何所需的上下文增强（例如，链接到个人资料或显示被提及的事件内容的预览）。如果将这样的提及变成链接，它们可以变成内部链接，[NIP-21](21.md) 链接或直接链接到处理这些引用的网络客户端。

---

## 个人资料提及过程的示例

假设 Bob 在一个具有搜索和自动补全功能的客户端中写贴文，当他写入字符 `@` 时，这个功能会被触发。

当 Bob 输入 `"hello @mat"` 时，客户端会提示他用 [mattn 的个人资料](https://gateway.nostr.com/p/2c7cc62a697ea3a7826521f3fd34f0cb273693cbe5e9310f35449f43622a5cdc)自动补全，显示一个图片和名字。

Bob 按下“enter”键，现在他看到他输入的贴文为 `"hello @mattn"`，`@mattn` 被高亮显示，表示它是一个提及。然而，内部的事件看起来是这样的：

```json
{
  "content": "hello nostr:nprofile1qqszclxx9f5haga8sfjjrulaxncvkfekj097t6f3pu65f86rvg49ehqj6f9dh",
  "created_at": 1679790774,
  "id": "f39e9b451a73d62abc5016cffdd294b1a904e2f34536a208874fe5e22bbd47cf",
  "kind": 1,
  "pubkey": "79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798",
  "sig": "f8c8bab1b90cc3d2ae1ad999e6af8af449ad8bb4edf64807386493163e29162b5852a796a8f474d6b1001cddbaac0de4392838574f5366f03cc94cf5dfb43f4d",
  "tags": [
    [
      "p",
      "2c7cc62a697ea3a7826521f3fd34f0cb273693cbe5e9310f35449f43622a5cdc"
    ]
  ]
}
```

(或者，提及也可能是一个 `nostr:npub1...` 的 URL。)

在 Bob 发布这个事件，Carol 看到它之后，她的客户端最初会按原样显示 `.content`，但稍后它会解析 `.content`，看到里面有一个 `nostr:` 的 URL，解码它，从中提取公钥（可能还有中继提示），从其内部数据库或中继中获取该个人资料，然后将完整的 URL 替换为名为 `@mattn` 的链接，该链接指向该个人资料的内部页面视图。

## 冗长且可能不必要的考虑

- 上面的例子非常具体，但这并不意味着所有的客户端都必须实现相同的流程。可能有些客户端根本不支持自动补全，他们只允许用户将原始的 [NIP-19](19.md) 代码粘贴到文本的正文中，然后在发布事件之前，将这些代码加上 `nostr:` 前缀。
- 引用其他事件的流程类似：用户可以粘贴一个 `note1...` 或 `nevent1...` 的代码，客户端会将其转换为 `nostr:note1...` 或 `nostr:nevent1...` 的 URL。然后在阅读这样的引用时，客户端可能会在预览框中显示被引用的贴文，或者类似的东西——或者什么都不显示。
- 可以采用其他的显示流程：例如，如果一个只设计用来处理 `kind:1` 贴文的客户端看到在 `.content` 中有一个 [`kind:30023`](23.md) 的 `nostr:naddr1...` URL 引用，它可以决定将其转换为链接到某个硬编码的 webapp，该 webapp 能够显示这样的事件。
- 客户端可能会给用户选择是否包含提及的事件或个人资料的标签的选项。如果有人想提及 `mattn`，但不通知他，但仍然希望在他们的贴文中有一个可以增强/点击的链接到他的个人资料，他们可以指示客户端对那个特定的提及 _不_ 创建一个 `["p", ...]` 标签。
- 同样，如果有人想引用另一篇贴文，但他们的引用并不意味着要出现在同一篇贴文的回复中，他们的客户端可以选择不为 `.content` 中的任何给定的 `nostr:nevent1...` URL 包含相应的 `["e", ...]` 标签。客户端可能会决定将这些高级功能暴露给用户，或者对这些事项有更多主观上的判断。
