NIP-11
======

中继信息文档
------------

`草案` `可选` `作者:scsibug` `作者:doc-hex` `作者:cameri`

中继可能会向客户端提供服务器元数据，以告知它们的能力，管理联系人，以及各种服务器属性。通过 HTTP 在与中继的 websocket 相同的 URI 上以 JSON 文档提供。

当中继接收到带有值为 `application/nostr+json` 的 `Accept` 头的指向支持 WebSocket 升级的 URI 的 HTTP(s) 请求时，它们**应该**返回具有以下结构的文档。

```json
{
  "name": <中继的字符串标识>,
  "description": <详细信息字符串>,
  "pubkey": <管理联系人公钥>,
  "contact": <管理备选联系方式>,
  "supported_nips": <中继支持的 NIP 编号列表>,
  "software": <中继软件 URL 的字符串标识>,
  "version": <版本标识符字符串>
}
```

任何字段都可以省略，客户端**必须**忽略它们不理解的任何额外字段。中继**必须**通过发送 `Access-Control-Allow-Origin`，`Access-Control-Allow-Headers` 和 `Access-Control-Allow-Methods` 头来接受 CORS 请求。

字段描述
--------

### 名称

中继可以选择一个 `name` 供客户端软件使用。这是一个字符串，**应该**少于 30 个字符，以避免客户端截断。

### 描述

关于中继的详细纯文本信息可能包含在 `description` 字符串中。建议这里不包含任何标记、格式化或换行符进行文字换行，而只使用双换行符来分隔段落。长度没有限制。

### 公钥

可以使用 `pubkey` 列出一个管理联系人，格式与 Nostr 事件相同（`secp256k1` 公钥的 32 字节十六进制）。如果列出了联系人，这为客户端提供了向系统管理员发送加密私信（参见 `NIP-04` ）的推荐地址。此地址预期被用于报告滥用或非法内容，提交错误报告，或请求其他技术支持。

中继操作员没有回应私信的义务。

### 联系方式

在 `contact` 字段下也可以列出一个备选联系方式，其目的与 `pubkey` 相同。**应该**优先使用 Nostr 公钥及私信而不是这个。此字段的内容**应该**为一个 URI，如 `mailto` 或 `https` 等方案为用户提供联系方式。

### 支持的 NIPs

随着 Nostr 协议的发展，某些功能可能只能由实现特定 `NIP` 的中继提供。此字段是在中继中实现的 `NIP` 的整数标识符的数组。示例包括 `1`，代表 `"NIP-01"` 和 `9`，代表 `"NIP-09"`。仅客户端适用的 `NIPs` **不该**被宣传，并可以被客户端忽略。

### 软件

中继服务器实现**可以**在 `software` 属性中提供。如果存在，这**必须**是项目主页的 URL。

### 版本

中继可以选择以字符串属性公布其软件版本。字符串格式由中继实现定义。建议这是版本号或提交标识符。

额外字段
--------

### 服务器限制

这些是中继对客户端施加的限制。客户端应该预期超过这些*实际*限制的请求会被立即拒绝或失败。

```json
{
...
  "limitation": {
        "max_message_length": 16384,
        "max_subscriptions": 20,
        "max_filters": 100,
        "max_limit": 5000,
        "max_subid_length": 100,
        "max_event_tags": 100,
        "max_content_length": 8196,
        "min_pow_difficulty": 30,
        "auth_required": true,
        "payment_required": true,
        "created_at_lower_limit":31536000,
        "created_at_upper_limit":3,
  }
...
}
```

- `max_message_length`：这是中继尝试解码和操作传入 JSON 的最大字节数。当你发送大的订阅时，你将受到这个值的限制。它也有效地限制了事件的大小。值是从 `[` 到 `]` 计算的，并且是在 UTF-8 序列化之后（所以一些 unicode 字符将占用 2-3 个字节）。它等于 WebSocket 消息帧的最大大小。

- `max_subscriptions`：在单个 websocket 连接到此中继上活跃的订阅的总数。与中继有（付费）关系的认证的客户端可能获得更高的限额。

- `max_filters`：每个订阅中的过滤器值的最大数量。必须是一或更高。

- `max_subid_length`：订阅 id 字符串的最大长度。

- `max_limit`：中继服务器将每个过滤器的 `limit` 值限制在这个数字。这意味着客户端将无法从单个订阅过滤器获取超过这个数字的事件。这种限制通常由中继默默地完成，但是有了这个数字，你可以知道如果你缩小了过滤器的时间范围或其他参数，那么还有其他的结果。

- `max_event_tags`：在任何事件中，这是 `tags` 列表中元素的最大数量。

- `max_content_length`：任何事件的 `content` 字段中的字符的最大数量。这是 unicode 字符计数。在序列化为 JSON 之后，它可能会更大（以字节为单位），并且仍然受到 `max_message_length` 的限制，如果有定义的话。

- `min_pow_difficulty`：新事件将需要至少这个难度的 PoW，基于 [NIP-13](13.md)，否则它们将被这个服务器拒绝。

- `auth_required`：这个中继要求在新连接可能执行任何其他操作之前进行 [NIP-42](42.md) 认证。即使设置为 False，对于特定的操作也可能需要认证。

- `payment_required`：这个中继要求在新连接可能执行任何操作之前进行付款。

- `created_at_lower_limit`：'created_at' 的下限，如 [NIP-22](22.md) 中定义

- `created_at_upper_limit`：'created_at' 的上限，如 [NIP-22](22.md) 中定义

### 事件留存

永久存储数据可能会产生一定的成本，因此中继可能希望声明留存时间。这里声明的值是对未经认证的用户和访客的默认值。付费用户可能会有其他的策略。

留存时间以秒为单位给出，`null` 表示无穷。如果提供零值，意味着事件将不会被存储。

```json
{
...
  "retention": [
    { "kinds": [0, 1, [5, 7], [40, 49]], "time": 3600 },
    { "kinds": [[40000, 49999]], "time": 100 },
    { "kinds": [[30000, 39999]], "count": 1000 },
    { "time": 3600, "count": 10000 }
  ]
...
}
```

`retention` 是一列规范：每个规范可适用于所有或部分类型。可以为类型字段指定一个包含起始和结束值的数组范围。指定类型（或全部）的事件将限制为 `count` 个数量和/或一个时间期限。

通过为这些 `kind` 值设定零的留存时间，可以有效地将依赖于特定 `kind` 数字的基于 Nostr 的协议列入黑名单。令人遗憾的是，它确实允许了客户端通过单个 HTTP 来快速发现支持他们协议的服务器。

对于 _短暂事件_，没有必要指定留存时间，因为它们不会被存储。

### 内容限制

一些中继可能受到某个国家的法律约束。这可能限制了这些中继上可以以明文存储的内容。所有客户端都被鼓励使用加密来解决这个限制。

这里无法描述每个国家的法律和政策限制，这些法律和政策本身通常是模糊的，并且不断变化。

因此，这个字段允许中继操作员指出哪些国家的法律可能最终会被强制执行在他们身上，然后间接地执行在他们用户的内容上。

用户应该避免那些他们不喜欢的国家的中继，和/或选择那些在更被推崇的区域的中继。暴露这种灵活性则取决于客户端软件。

```json
{
...
  "relay_countries": [ "CA", "US" ],
...
}
```

- `relay_countries`：可能会影响此中继的法律和政策的 二级 ISO 国家代码（ISO 3166-1 alpha-2）列表。`EU` 可用于欧洲联盟国家。

请记住，中继可能并非托管在中继法人实体的所在国，所以很可能涉及多个国家。

### 社区偏好

至少对于公开的贴文，中继可能会试图构建一个本地社区。这将鼓励用户在该中继上关注除了他们常规个人关注外的全球订阅。为了支持这个目标，中继**可以**指定以下一些值。

```json
{
...
  "language_tags": [ "en", "en-419" ],
  "tags": [ "sfw-only", "bitcoin-only", "anime" ],
  "posting_policy": "https://example.com/posting-policy.html",
...
}
```

- `language_tags` 是一个有序列表，列出了在中继上主要使用的 [IETF 语言标签](https://en.wikipedia.org/wiki/IETF_language_tag)。

- `tags` 是一个关于讨论主题限制的列表。例如，`sfw-only` 表示只鼓励在这个中继上发布“适合在工作场所查看”的内容。这依赖于“工作”、“社区”觉得讨论什么是“安全”的假设。随着时间的推移，可能会出现一组通用的标签，使用户能够找到适合他们需求的中继，客户端软件将能够轻松解析这些标签。`bitcoin-only` 标签表示任何*山寨币*，*"加密"*或*区块链*的评论都将被无情地嘲笑。

- `posting_policy` 是一个链接，指向一个详细说明中继社区政策的人类可读页面。在 `sfw-only` 为 True 的情况下，链接到一个详细说明你的发布政策的页面是很重要的。

`description` 字段应用于简要描述你的社区目标和价值观。`posting_policy` 用于提供额外的详细信息和法律条款。使用 `tags` 字段来标明内容的限制，或要讨论的主题，这些可以由适当的客户端软件进行机器处理。

### 付费中继

需要付费的中继可能希望公开他们的费用表。

```json
{
...
  "payments_url": "https://my-relay/payments",
  "fees": {
    "admission": [{ "amount": 1000000, "unit": "msats" }],
    "subscription": [{ "amount": 5000000, "unit": "msats", "period": 2592000 }],
    "publication": [{ "kinds": [4], "amount": 100, "unit": "msats" }],
  },
...
}
```

### 图标

指向用作中继图标的图像的 URL。建议使用方形。

```json
{
...
  "icon": "https://nostr.build/i/53866b44135a27d624e99c6165cabd76ac8f72797209700acb189fce75021f47.jpg",
...
}
```

### 示例


截至 2023 年 5 月 2 日，以下的 `curl` 命令提供了这些结果。

	>curl -H "Accept: application/nostr+json" https://eden.nostr.land

	{"name":"eden.nostr.land",
	"description":"Eden Nostr Land - Toronto 1-01",
	"pubkey":"00000000827ffaa94bfea288c3dfce4422c794fbb96625b6b31e9049f729d700",
	"contact":"me@ricardocabral.io",
	"supported_nips":[1,2,4,9,11,12,15,16,20,22,26,28,33,40],
	"supported_nip_extensions":["11a"],
	"software":"git+https://github.com/Cameri/nostream.git",
	"version":"1.22.6",
	"limitation":{"max_message_length":1048576,
				  "max_subscriptions":10,
				  "max_filters":2500,
				  "max_limit":5000,
				  "max_subid_length":256,
				  "max_event_tags":2500,
				  "max_content_length":65536,
				  "min_pow_difficulty":0,
				  "auth_required":false,
				  "payment_required":true},
	"payments_url":"https://eden.nostr.land/invoices",
	"fees":{"admission":[{"amount":5000000,"unit":"msats"}],
	        "publication":[]}},
    "icon": "https://nostr.build/i/53866b44135a27d624e99c6165cabd76ac8f72797209700acb189fce75021f47.jpg"
