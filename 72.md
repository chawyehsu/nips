NIP-72
======

受管理的社区 (Reddit 风格)
--------------------------

`草案` `可选` `作者:vitorpamplona` `作者:arthurfranca`

这个 NIP 的目标是创建围绕一个主题的受管理的公共社区。它定义了可替换事件 `kind:34550` 来定义社区和当前的版主/管理员列表。想要在社区中发布的用户，只需在任何 Nostr 事件中使用社区的 `a` 标签。版主发布批准事件 `kind:4550`，将社区与新贴文链接起来。

# 社区定义

`Kind:34550` **应该**包括任何有助于定义社区和版主集合的字段。`relay` 标签**可以**用来描述下载请求和批准的首选中继。

```json
{
  "id": "<序列化事件数据的 SHA-256 的 32 字节小写十六进制编码>",
  "pubkey": "<事件创建者的 32 字节小写十六进制编码的公钥>",
  "created_at": <unix 时间戳，以秒为单位>,
  "kind": 34550,
  "tags": [
    ["d", "<社区名称>"],
    ["description", "<社区描述>"],
    ["image", "<社区图片 url>", "<宽度>x<高度>"],

    //.. 定义社区的其他相关标签

    // 版主
    ["p", "<公钥 1 的 32 字节十六进制>", "<可选的推荐中继 URL>", "moderator"],
    ["p", "<公钥 2 的 32 字节十六进制>", "<可选的推荐中继 URL>", "moderator"],
    ["p", "<公钥 3 的 32 字节十六进制>", "<可选的推荐中继 URL>", "moderator"],

    // 社区使用的中继（带有可选标记）
    ["relay", "<托管作者类型 0 的中继>", "author"],
    ["relay", "<发送和接收请求的中继>", "requests"],
    ["relay", "<发送和接收批准的中继>", "approvals"],
    ["relay", "<发布请求和获取批准的中继>"]
  ]
}
```

# 新贴文请求

任何 Nostr 事件都可以作为贴文请求。客户端**必须**在新的贴文事件中添加社区的 `a` 标签，以便提交给版主审批。

```json
{
  "id": "<序列化事件数据的 SHA-256 的 32 字节小写十六进制编码>",
  "pubkey": "<事件创建者的 32 字节小写十六进制编码的公钥>",
  "created_at": <unix 时间戳，以秒为单位>,
  "kind": 1,
  "tags": [
    ["a", "34550:<社区事件作者公钥>:<社区的 d-标识符>", "<可选的中继 URL>"],
  ],
  "content": "<我的内容>"
}
```

社区管理客户端**可以**过滤给定 `kind:34550` 事件的所有提及，并请求版主批准每个提交。版主**可以**随时使用事件删除（参见 [NIP-09](09.md)）删除其对贴文的批准。

# 版主的贴文批准

贴文批准事件**必须**包括版主发布到的社区的（一个或多个）`a` 标签，贴文的 `e` 标签和贴文作者的 `p` 标签（用于批准通知）。事件还**应该**包括在 `.content` 中的字符串化的 `post request` 事件（[NIP-18-style](18.md)）和带有原始贴文事件类型的 `k` 标签，以便按类型过滤已批准的贴文。

```json
{
  "id": "<序列化事件数据的 SHA-256 的 32 字节小写十六进制编码>",
  "pubkey": "<事件创建者的 32 字节小写十六进制编码的公钥>",
  "created_at": <unix 时间戳，以秒为单位>,
  "kind": 4550,
  "tags": [
    ["a", "34550:<社区事件作者公钥>:<社区的 d-标识符>", "<可选的中继 URL>"],
    ["e", "<贴文请求 ID>", "<可选的中继 URL>"],
    ["p", "<贴文请求作者 ID>", "<可选的中继 URL>"],
    ["k", "<新贴文请求种类>"],
  ],
  "content": "<新贴文请求 JSON>"
}
```

建议多个版主批准贴文，以避免当版主从所有者列表中被移除时，贴文从社区中被删除。如果需要轮换全部版主列表，新的版主集合必须为过去的贴文签署新的批准，否则社区将重新开始。所有者也可以定期复制并重新签署每个版主的批准事件，以确保贴文不会随着版主的消失而消失。

可替换事件的贴文批准可以通过三种方式创建：(i) 如果版主希望批准对可替换事件的每个单独更改，可以将可替换事件标记为 `e` 标签；(ii) 如果版主授权可替换事件的作者进行更改，无需额外的批准，可以将可替换事件标记为 `a` 标签；(iii) 通过将可替换事件的 `e` 和 `a` 标签都标记出来，使客户端能够显示事件的原始版本和更新版本，并在用户界面中添加适当的备注。由于中继被指示删除可替换事件的旧版本，经 `e`- 批准的 `.content` **必须**是事件的具体版本，否则客户端可能无法在任何地方找到该版本的内容。

客户端**应该**将任何非 `34550:*` 的 `a` 标签视为要包含在所有 `34550:*` 的 `a` 标签中的贴文。

# 显示

社区客户端**应该**显示至少由 1 个版主或社区所有者批准的贴文。

以下过滤器显示已批准的贴文。

```js
{
  "authors": ["<Author pubkey>", "<Moderator1 pubkey>", "<Moderator2 pubkey>", "<Moderator3 pubkey>", ...],
  "kinds": [4550],
  "#a": ["34550:<Community event author pubkey>:<d-identifier of the community>"],
}
```

客户端**可以**应用户的请求，隐藏被封禁版主的批准。
