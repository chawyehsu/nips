NIP-22
======

事件 `created_at` 限制
----------------------

`草案` `可选` `作者:jeffthibault` `作者:Giszmo`

中继可以定义事件的 `created_at` 可接受的上限和下限。上限和下限都**必须**是 [NIP-01](01.md) 中定义的以秒为单位的 unix 时间戳。

如果中继支持这个 NIP，当 `created_at` 时间戳不在允许的限制内时，中继**应该**向客户端发送一个 `OK` 结果，表示事件没有被存储。

客户端行为
----------

客户端**应该**使用 [NIP-11](11.md) 的 `supported_nips` 字段来了解中继是否使用这个 NIP 定义的事件 `created_at` 时间限制。

动机
----

这个 NIP 规定了中继接受的事件时间戳的限制，并允许客户端了解有这些限制的中继。

事件的 `created_at` 字段只是一个 unix 时间戳，可以设置为过去或未来的时间。中继接受并分享的事件可以追溯到 20 年前，或者 50000 年后。这个 NIP 旨在为不想存储带有*任意*时间戳的事件的中继定义一种自限的方式。

如果用户用错误的系统时钟写入 - 或者试图写入 - _可替换事件_ 可能会表现得出乎意料。在对一个更新进行持久化时使用倒填日期将会导致更新不会被完成并且没有通知，而如果使用远期日期执行了更新，则将无法用现在正确的时间做另一次更新。

广泛采用这个 NIP 可能会创造更好的用户体验，因为它会减少出现顺序混乱或者来自遥远过去或未来不可能的日期的事件的数量。

请记住，有一种用例是用户将他们的旧帖子迁移到新的中继。如果中继拒绝接受不是最近创建的事件，它不能服务于这种用例。

Python (伪代码) 示例
--------------------

```python
import time

TIME = int(time.time())
LOWER_LIMIT = TIME - (60 * 60 * 24) # 将下限定义为过去的 1 天
UPPER_LIMIT = TIME + (60 * 15)      # 将上限定义为未来的 15 分钟

if event.created_at not in range(LOWER_LIMIT, UPPER_LIMIT):
  ws.send('["OK", event.id, False, "invalid: the event created_at field is out of the acceptable range (-24h, +15min) for this relay"]')
```

注意：这些只是示例限制，中继操作员可以选择他们想要的任何限制。
