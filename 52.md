NIP-52
======

日程事件
--------

`草案` `可选` `作者:tyiu`

此规范定义了表示发生在特定时刻或时刻之间的日程事件。这些日程事件是根据 [NIP-09](09.md) 可替换和可删除的参数化事件。

与本 NIP 中特指的 `日程事件` 术语不同，术语 `事件` 在所有 NIP 中广泛使用，用于描述任何 Nostr 事件。这里进行区分是为了区别这两个术语。

## 日程事件

有两种类型的日程事件，以不同的类型数字表示：基于日期的和基于时间的日程事件。日程事件不需要是[日程](#calendar)的一部分。

### 基于日期的日程事件

这种日程事件从一个日期开始，结束于未来的另一个不同日期之前。它适用于全天或多日事件，其中时间和时区没有意义。例如，周年纪念，公众假期，休假日。

#### 格式

该格式使用参数化可替换事件类型 `31922`。

这些事件的 `.content` 是可选的，应该是日程事件的详细描述。

标签列表如下：
* `d`（必需）全局唯一标识符（UUID）。由创建日程事件的客户端生成。
* `name`（必需）日程事件的名称
* `start`（必需）包含的开始日期，采用 ISO 8601 格式（YYYY-MM-DD）。必须小于 `end`，如果存在的话。
* `end`（可选）结束日期，采用 ISO 8601 格式（YYYY-MM-DD）。如果省略，日程事件将在 `start` 的同一日期结束。
* `location`（可选）日程事件的位置。例如地址，GPS 坐标，会议室名称，视频通话链接
* `g`（可选）[geohash](https://en.wikipedia.org/wiki/Geohash) 以将日程事件与可搜索的物理位置关联
* `p`（可选，可重复）参与者的 32 字节十六进制公钥，可选的推荐中继 URL，以及参与者在会议中的角色
* `t`（可选，可重复）标签以分类日程事件
* `r`（可选，可重复）引用/链接到网页，文档，视频通话，录制的视频等。

```json
{
  "id": <序列化事件数据的 SHA-256 的 32 字节小写十六进制编码>,
  "pubkey": <事件创建者的 32 字节小写十六进制编码的公钥>,
  "created_at": <unix 时间戳，以秒为单位>,
  "kind": "31922",
  "content": "<日程事件的描述>",
  "tags": [
    ["d", "<UUID>"],

    ["name", "<日程事件的名称>"],

    // 日期
    ["start", "<YYYY-MM-DD>"],
    ["end", "<YYYY-MM-DD>"],

    // 位置
    ["location", "<位置>"],
    ["g", "<geohash>"],

    // 参与者
    ["p", "<公钥的 32 字节十六进制编码>", "<可选的推荐中继 URL>", "<角色>"],
    ["p", "<公钥的 32 字节十六进制编码>", "<可选的推荐中继 URL>", "<角色>"],

    // 标签
    ["t", "<标签>"],
    ["t", "<标签>"],

    // 引用链接
    ["r", "<url>"],
    ["r", "<url>"]
  ]
}
```

### 基于时间的日程事件

这种日程事件贯穿于开始时间和结束时间。

#### 格式

该格式使用参数化可替换事件类型 `31923`。

这些事件的 `.content` 是可选的，应该是日程事件的详细描述。

标签列表如下：
* `d`（必需）全局唯一标识符（UUID）。由创建日程事件的客户端生成。
* `name`（必需）日程事件的名称
* `start`（必需）包含的开始 unix 时间戳，以秒为单位。必须小于 `end`，如果存在的话。
* `end`（可选）结束 unix 时间戳，以秒为单位。如果省略，日程事件将瞬间结束。
* `start_tzid`（可选）开始时间戳的时区，由 IANA 时区数据库定义。例如，`America/Costa_Rica`
* `end_tzid`（可选）结束时间戳的时区，由 IANA 时区数据库定义。例如，`America/Costa_Rica`。如果省略并提供了 `start_tzid`，则结束时间戳的时区与开始时间戳相同。
* `location`（可选）日程事件的位置。例如地址，GPS 坐标，会议室名称，视频通话链接
* `g`（可选）[geohash](https://en.wikipedia.org/wiki/Geohash) 以将日程事件与可搜索的物理位置关联
* `p`（可选，可重复）参与者的 32 字节十六进制公钥，可选的推荐中继 URL，以及参与者在会议中的角色
* `t`（可选，可重复）标签以分类日程事件
* `r`（可选，可重复）引用/链接到网页，文档，视频通话，录制的视频等。

```json
{
  "id": <序列化事件数据的 SHA-256 的 32 字节小写十六进制编码>,
  "pubkey": <事件创建者的 32 字节小写十六进制编码的公钥>,
  "created_at": <unix 时间戳，以秒为单位>,
  "kind": "31923",
  "content": "<日程事件的描述>",
  "tags": [
    ["d", "<UUID>"],

    ["name", "<日程事件的名称>"],

    // 时间戳
    ["start", "<unix 时间戳，以秒为单位>"],
    ["end", "<unix 时间戳，以秒为单位>"],

    ["start_tzid", "<IANA 时区数据库标识符>"],
    ["end_tzid", "<IANA 时区数据库标识符>"],

    // 位置
    ["location", "<位置>"],
    ["g", "<geohash>"],

    // 参与者
    ["p", "<公钥的 32 字节十六进制编码>", "<可选的推荐中继 URL>", "<角色>"],
    ["p", "<公钥的 32 字节十六进制编码>", "<可选的推荐中继 URL>", "<角色>"],

    // 标签
    ["t", "<标签>"],
    ["t", "<标签>"],

    // 引用链接
    ["r", "<url>"],
    ["r", "<url>"]
  ]
}
```

## 日程

日程是日程事件的集合，使用类型 `31924` 表示为自定义可替换列表事件。用户可以拥有多个日程。人们可以创建日程以将日程事件划分为特定的目的。例如，个人，工作，旅行，聚会和会议。

### 格式

该格式定义为一种类型 `31924` 的自定义可替换列表，具有如下所述的标签列表：
* `d`（必需）日程名称
* `a`（重复）引用到对应 `31922` 或 `31923` 类型日程事件的标签

```json
{
  "kind": 31924,
  "tags": [
    ["d", "<calendar name>"],
    ["a", "<31922 or 31923>:<calendar event author pubkey>:<d-identifier of calendar event>", "<optional relay url>"],
    ["a", "<31922 or 31923>:<calendar event author pubkey>:<d-identifier of calendar event>", "<optional relay url>"]
  ]
}
```

## 日程事件 RSVP

日程事件 RSVP 是对日程事件的回应，用来表示用户的出席意图。

如果日程事件标记了一个公钥，那可以被解释为日程事件创建者邀请该用户参加。客户端**可以**选择提示用户对日程事件进行 RSVP。

任何用户都可以 RSVP，即使他们没有在日程事件上被标记。客户端**可以**选择提示日程事件创建者邀请已经 RSVP 的用户。客户端也**可以**选择忽略这些 RSVP。

本 NIP 没有定义一个没有被标记的用户 RSVP 后是否有权参加日程事件。这由日程事件的创建者来确定语义。

本 NIP 也没有定义日程事件在收到 RSVP 后进行修改会发生什么。

### 格式

该格式使用参数化可替换事件类型 `31925`。

这些事件的 `.content` 是可选的，应该是一个自由形式的注释，为这个日程事件的回应添加更多的上下文。

标签列表如下：
* `a` (必需) 对应 `31922` 或 `31923` 类型日程事件的引用标签。
* `d` (必需) 全局唯一标识符。由创建日程事件 RSVP 的客户端生成。
* `L` (必需) 根据 [NIP-32](32.md) 的 `status` 标记命名空间
* `l` (必需) 在 `status` 标记命名空间下的 `accepted`，`declined` 或 `tentative` 标记，根据 [NIP-32](32.md)。对引用日程事件的出席状态。
* `L` (可选) 根据 [NIP-32](32.md) 的 `freebusy` 标记命名空间。只有在相同标记命名空间下存在对应的 `l` 标签时才存在。
* `l` (可选) 在 `freebusy` 标记命名空间下的 `free` 或 `busy` 标记，根据 [NIP-32](32.md)。确定用户在日程事件期间是空闲还是忙碌。如果 `status` 标记设置为 `declined`，则必须省略或忽略此标签。只有在相同标记命名空间下存在对应的 `l` 标签时才存在。

```json
{
  "id": <序列化事件数据的 SHA-256 的 32 字节小写十六进制编码>,
  "pubkey": <事件创建者的 32 字节小写十六进制编码的公钥>,
  "created_at": <unix 时间戳，以秒为单位>,
  "kind": "31925",
  "content": "<note>",
  "tags": [
    ["a", "<31922 or 31923>:<calendar event author pubkey>:<d-identifier of calendar event>", "<optional relay url>"],
    ["d", "<UUID>"],
    ["L", "status"],
    ["l", "<accepted/declined/tentative>", "status"],
    ["L", "freebusy"],
    ["l", "<free/busy>", "freebusy"]
  ]
}
```

## 未解决的局限

* 确实私人事件

## 有意不支持的场景

### 循环日程事件

循环日程事件带来了很多复杂性，使得人和软件难以应对。这种复杂性包括邀请者之间的时区差异，夏令时，闰年，多个日程系统，一次性的日程或其他元数据的变化等等。

本 NIP 有意省略了对循环日程事件的支持，并将这种复杂性推给客户端，如果它们愿意，可以手动实现。具有重复元数据的单个日程事件代表循环日程事件。
