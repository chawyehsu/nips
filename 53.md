NIP-53
======

实时活动
--------

`草案` `可选` `作者:vitorpamplona` `作者:v0l`

## 摘要

服务提供商希望向 Nostr 网络提供实时活动，以便参与者可以轻松地登录并由客户端查询。本 NIP 描述了一种推广使用公钥参与此类实时活动的通用框架。

# 实时事件

定义了一种特殊事件，`kind:30311`“实时事件”，作为公共 `p` 标签的 _参数化可替换事件_。每个 `p` 标签**应该**有一个**可显示**的记号名称，用于表示用户在事件中的角色（例如 `主持人`，`演讲者`，`参与者`），中继信息**可以**为空。随着参与者加入和离开活动，此事件将不断更新。

例如：

```js
{
  "kind": 30311,
  "tags": [
    ["d", "<唯一标识符>"],
    ["title", "<活动标题>"],
    ["summary", "<描述>"],
    ["image", "<预览图 url>"],
    ["t", "hashtag"]
    ["streaming", "<url>"],
    ["recording", "<url>"], // 用于在活动结束后放置编辑过的录像
    ["starts", "<unix timestamp in seconds>"],
    ["ends", "<unix timestamp in seconds>"],
    ["status", "<planned, live, ended>"],
    ["current_participants", "<number>"],
    ["total_participants", "<number>"],
    ["p", "91cf9..4e5ca", "wss://provider1.com/", "Host", "<proof>"],
    ["p", "14aeb..8dad4", "wss://provider2.com/nostr", "Speaker"],
    ["p", "612ae..e610f", "ws://provider3.com/ws", "Participant"],
    ["relays", "wss://one.com", "wss://two.com", ...]
  ],
  "content": "",
  ...其它字段
}
```

每个活动应使用不同的 `d` 标签。所有其他标签都是可选的。

服务提供商**应该**保持参与者列表较小（例如，少于 1000 个用户），当达到限制时，服务提供商**应该**选择参与者的名额。客户端不应期望得到一个全面的列表。一旦活动结束，可以删除或更新事件以总结活动并提供异步内容（例如，活动录像）。

期望客户端订阅常规的 `kind:30311` 事件或特定的关注列表及状态。客户端**可以**显示参与者在活动中的角色以及加入活动的入口。

预计实时活动管理客户端会在活动期间持续更新 `kind:30311`。客户端**可以**选择在没有任何更新的 1 小时后将 `status=live` 事件视为 `ended`。当状态从 `live` 变化/变为 `live` 时，**应该**更新 `starts` 和 `ends` 时间戳。

**必须**使用 [NIP-19](19.md) 的 `naddr` 代码以及 `a` 标签链接到活动。

## 参与证明

活动所有者可以在每个 `p` 标签的第 5 项中添加证明，以表明参与者同意加入活动。证明是由每个 `p` 的私钥对事件完整 `a` 标签（`kind:pubkey:dTag`）进行的 SHA256 签名，以十六进制编码。

如果有证明，客户端**可以**只显示参与者，或者如果没有证明，客户端**可以**将参与者显示为“被邀请”。

这个功能很重要，以避免恶意活动的所有者在不知情的情况下将大账户持有者添加到活动中，以吸引他们的关注者进入恶意活动所有者的陷阱。

# 实时聊天消息

事件 `kind:1311` 是实时聊天的频道消息。客户端**必须**在 `root` 记号处包含活动的 `a` 标签。也可以使用其它 Kind-1 标签如 `reply` 和 `mention`。

```js
{
  "id": "<序列化事件数据的 SHA-256 的 32 字节小写十六进制编码>",
  "pubkey": "<事件创建者的 32 字节小写十六进制编码的公钥>",
  "created_at": "<unix 时间戳，以秒为单位>",
  "kind": 1311,
  "tags": [
    ["a", "30311:<Community event author pubkey>:<d-identifier of the community>", "<Optional relay url>", "root"],
  ],
  "content": "Zaps to live streams is beautiful."
}
```

# 使用案例

常见的使用案例包括会议室/研讨会，一起观看的活动，或者像 [live.snort.social](https://live.snort.social) 和 [nostrnests.com](https://nostrnests.com) 这样的活动空间。

# 示例

直播

```json
{
  "id": "57f28dbc264990e2c61e80a883862f7c114019804208b14da0bff81371e484d2",
  "pubkey": "1597246ac22f7d1375041054f2a4986bd971d8d196d7997e48973263ac9879ec",
  "created_at": 1687182672,
  "kind": 30311,
  "tags": [
    ["d", "demo-cf-stream"],
    ["title", "Adult Swim Metalocalypse"],
    ["summary", "Live stream from IPTV-ORG collection"],
    ["streaming", "https://adultswim-vodlive.cdn.turner.com/live/metalocalypse/stream.m3u8"],
	["starts", "1687182672"]
    ["status", "live"],
    ["t", "animation"],
    ["t", "iptv"],
    ["image", "https://i.imgur.com/CaKq6Mt.png"]
  ],
  "content": "",
  "sig": "5bc7a60f5688effa5287244a24768cbe0dcd854436090abc3bef172f7f5db1410af4277508dbafc4f70a754a891c90ce3b966a7bc47e7c1eb71ff57640f3d389"
}
```

直播聊天消息

```json
{
  "id": "97aa81798ee6c5637f7b21a411f89e10244e195aa91cb341bf49f718e36c8188",
  "pubkey": "3f770d65d3a764a9c5cb503ae123e62ec7598ad035d836e2a810f3877a745b24",
  "created_at": 1687286726,
  "kind": 1311,
  "tags": [
    ["a", "30311:1597246ac22f7d1375041054f2a4986bd971d8d196d7997e48973263ac9879ec:demo-cf-stream", "", "root"]
  ],
  "content": "Zaps to live streams is beautiful.",
  "sig": "997f62ddfc0827c121043074d50cfce7a528e978c575722748629a4137c45b75bdbc84170bedc723ef0a5a4c3daebf1fef2e93f5e2ddb98e5d685d022c30b622"
}
````
