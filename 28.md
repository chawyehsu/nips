NIP-28
======

公共聊天
--------

`草案` `可选` `作者:ChristopherDavid` `作者:fiatjaf` `作者:jb55` `作者:Cameri`

本 NIP 为公共聊天频道、频道消息和基本的客户端侧节制定义了新的事件类型。

它为立即使用预留了五种事件类型（40-44）：

- `40 - 创建频道`
- `41 - 频道元数据`
- `42 - 频道消息`
- `43 - 隐藏消息`
- `44 - 静音用户`

以客户端为中心的节制赋予客户端开发者对他们希望在其应用中包含哪些类型的内容的自由裁量权，同时对中继没有额外的要求。

## 类型 40：创建频道

创建一个公共聊天频道。

在频道创建的 `content` 字段中，客户端应该包含基本的频道元数据（`name`，`about`，`picture`，如类型 41 所指定）。

```json
{
    "content": "{\"name\": \"Demo Channel\", \"about\": \"A test channel.\", \"picture\": \"https://placekitten.com/200/200\"}",
    ...
}
```

## 类型 41：设置频道元数据

更新频道的公共元数据。

客户端和中继**应该**将类型 41 的事件处理为类似于类型 33 的可替换事件，其中的信息用于更新元数据，而不修改频道的事件 id。只需要存储最新的类型 41。

客户端**应该**忽略来自除类型 40 公钥以外的公钥的类型 41。

客户端**应该**支持基本的元数据字段：

- `name` - 字符串 - 频道名称
- `about` - 字符串 - 频道描述
- `picture` - 字符串 - 频道图片的 URL

客户端**可以**添加额外的元数据字段。

客户端**应该**使用 [NIP-10](10.md) 标记为“e”的标签来推荐一个中继。

```json
{
    "content": "{\"name\": \"Updated Demo Channel\", \"about\": \"Updating a test channel.\", \"picture\": \"https://placekitten.com/201/201\"}",
    "tags": [["e", <channel_create_event_id>, <relay-url>]],
    ...
}
```

## 类型 42：创建频道消息

向频道发送文本消息。

客户端**应该**使用标记为“e”的 [NIP-10](10.md) 标签来推荐一个中继，并指定它是一个回复还是一个根消息。

客户端**应该**将 [NIP-10](10.md) 的“p”标签附加到回复中。

根消息：

```json
{
    "content": <string>,
    "tags": [["e", <kind_40_event_id>, <relay-url>, "root"]],
    ...
}
```

回复另一个消息：

```json
{
    "content": <string>,
    "tags": [
        ["e", <kind_40_event_id>, <relay-url>, "root"],
        ["e", <kind_42_event_id>, <relay-url>, "reply"],
        ["p", <pubkey>, <relay-url>],
        ...
    ],
    ...
}
```

## 类型 43：隐藏消息

用户不再希望看到某条特定消息。

`content` 可以选择性地包含元数据，如 `reason`。

如果存在来自某用户的 43 事件，且其匹配 42 事件的 `id`，则客户端**应该**对该用户隐藏掉这些 42 事件。

除发送 43 事件的用户外，客户端**可以**为其他用户隐藏 42 事件。

（例如，如果有三个用户“隐藏”了一个事件，给出的理由包含“色情”这个词，那么一个是 iOS 应用的 Nostr 客户端可能会选择为所有 iOS 客户端隐藏该消息。）

```json
{
    "content": "{\"reason\": \"Dick pic\"}",
    "tags": [["e", <kind_42_event_id>]],
    ...
}
```

## 类型 44：静音用户

用户不再希望看到来自另一个用户的消息。

`content` 可以选择性地包含元数据，如 `reason`。

如果存在来自某用户的 44 事件，其匹配 42 事件的 `pubkey`，则客户端**应该**对该用户隐藏掉这些 42 事件。

除发送 44 事件的用户外，客户端**可以**为其他用户隐藏 42 事件。

```json
{
    "content": "{\"reason\": \"Posting dick pics\"}",
    "tags": [["p", <pubkey>]],
    ...
}
```

## NIP-10 中继推荐

对于 [NIP-10](10.md) 中继推荐，客户端通常**应该**使用最初（最早）的类型 40 事件的中继 URL。

客户端**可以**推荐任何中继 URL。例如，如果托管频道的原始类型 40 事件的中继离线，客户端可以从备份中继或比原始中继更可信任的中继获取频道数据。

## 动机

如果我们正在解决社交媒体的抗审查通信问题，我们也可以以 Telegram 风格的消息来解决它。

我们可以将全球对话从封闭的花园带到一个真正开放给所有人的公共广场。

## 额外信息

- [带有 fiatjaf+jb55 评论的聊天演示 PR](https://github.com/ArcadeCity/arcade/pull/28)
- [关于 NIP16 的对话](https://t.me/nostr_protocol/29566)
